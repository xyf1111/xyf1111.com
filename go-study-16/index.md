# Go Study 16


## 复制
将切片a中的元素复制到切片b中。

最简单的、最常用的方法就是使用内置的copy方法
```go
// 一次将内存申请到位
b = make([]T, len(a))
copy(b, a)
```

除了使用内置的copy函数外，还有下面两种使用append函数复制切片的方法
```go
b = append([]T(nil), a...)
b = append(a[:0:0], a...)
```

这两种方法通常比使用copy函数复制的方法要慢一点，但是如果在复制之后有更多的元素要添加到b中，那么它们的效率会更高。

## 剪切
将切片a中索引i~j位置的元素剪切掉

可以按照下面的方式，使用append函数完成
```go
a = append(a[:i], a[j:]...)
```

## 删除
将切片a中索引位置为i的元素删除。

同样可以使用上面剪切的方式使用append函数完成删除操作
```go
a = append(a[:i], a[i+1:]...)
```

或者搭配copy函数使用切片表达式完成删除操作
```go
a = a[:i + copy(a[i:], a[i+1])]
```

此外，如果只需要删除索引为i的元素，无需保留切片元素原有的顺序，那么还可以使用下面这种简单的方式删除
```go
// 将最后一个元素移到索引i处
a[i] = a[len(a) - 1]
// 截掉最后一个元素
a = a[:len(a) - 1]
```

## 剪切或删除操作可能引起的内存泄露
需要特别注意的是，如果切片a中的元素是一个指针类型或者包含指针字段的结构体类型(需要被垃圾回收)，上面的剪切和删除的示例代码会存在一个潜在的内存泄露问题：一些具有值的元素仍被切片a引用，因此无法被垃圾回收机制回收掉。下面代码可以解决这个问题。

### 剪切
```go
copy(a[i:], a[j:])
for k, n := len(a)-j+i, len(a); k < n; k++ {
    // 或类型T的零值
    a[k] = nil
}
a = a[:len(a)-j+i]
```

### 删除
```go
copy(a[i:], a[i+1:])
// 或类型T的零值
a[len(a)-1] = nil
a = a[:len(a)-1]
```

### 删除但不保留元素原有顺序
```go
a[i] = a[len(a)-1]
a[len(a)-1] = nil
a = a[:len(a)-1]
```

## 内部扩张
在切片a的索引i之后扩张j个元素

使用两个append函数完成，即先将索引i之后的元素追加到一个长度为j的切片后，再将这个切片中的所有元素追加到切片a的索引i之后
```go
a = append(a[:i], append(make([]T, j), a[i:]...)...)
```

扩张的这一部分元素为T类型的零值
## 尾部扩张
将切片a的尾部扩张j个元素的空间。
```go
a = append(a, make([]T, j)...)
```

扩张的这一部分元素同样为T类型的零值

## 过滤
按照一定的规则将切片a中的元素进行就地过滤

这里假设过滤的条件已经封装为keep函数，使用for range遍历切片a的所有元素逐一调用keep函数进行过滤
```go
n := 0
for _, x := range a {
    if keep(x) {
        // 保留该元素
        a[n] = x
        n++
    }
}
// 截取切片中需保留的元素
a = a[:n]
```

## 插入
将元素x插入切片a的索引i处

还是使用两个append函数完成插入x的操作
```go
a = append(a[:i], append([]T{x}, a[i:...])...)
```

第二个append函数创建了一个具有自己底层数组的新切片，并将a[i:] 中的元素复制到该切片，然后由第一个append函数将这些元素复制回切片。

我们可以通过使用另一个方法来避免新切片的创建(以及由此产生的内存垃圾)和第二个副本：
```go
// 这里应使用元素的零值
a = append(a, 0)
copy(a[i+1:], a[i:])
a[i] = x
```

## 追加
将元素x追加到切片a的最后

这里使用append函数即可
```go
a = append(a, x)
```

## 弹出
将切片a的最后一个元素弹出

这里使用切片表达式完成弹出操作
```go
x, a = a[len(a)-1], a[:len(a)-1]
```

弹出切片a的第一个元素
```go
x, a = a[0], a[i:]
```

## 前插
将元素x前插到切片a的最开始
```go
a = append([]T{x}, a...)
```
